.. _merchant:

Merchant
========

Create
------

The first action for the integration will be create a new 'Merchant', we also provide this structure to allow this.

+----------+-----------------------+
| ENDPOINT | /api/customer/create/ |
+----------+-----------------------+
| METHOD   | POST                  |
+----------+-----------------------+

**Fields Description**

+----------+----------------------+--------------+------+----------------------------------------------------+
| Required | Field                | Type         | Size | Description                                        |
+==========+======================+==============+======+====================================================+
| PERSONAL DATA                                                                                              |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | merchant_reference   | Alphanumeric | 128  | UniqueID generated in partner registration process |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | email                | Alphanumeric | 120  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | cpf                  | Numeric      | 11   | No formatting is required, Ex. 72816426289         |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | first_name           | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | last_name            | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | gender               | Alphanumeric | 1    | M= Male / F= Female                                |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | birth_date           | Date         | 10   | Format d/m/Y / Ex 02/12/1993                       |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | document             | Numeric      | 20   | In Brazil we use for RG, no formatting is required |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | telephone            | Numeric      | 20   | No formatting is required with DDD, ex. 1123234444 |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | cellphone            | Numeric      | 20   | No formatting is required with DDD, ex. 1123234444 |
+----------+----------------------+--------------+------+----------------------------------------------------+
| ADDRESS DATA                                                                                               |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | address_street       | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | address_number       | Numeric      | 10   |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | address_district     | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | address_postalcode   | Numeric      | 8    |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | address_complement   | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | address_city         | Alphanumeric | 20   |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | address_state        | Alphanumeric | 2    | Always using abbreviation form.  Ex. SP / RJ / MG  |
+----------+----------------------+--------------+------+----------------------------------------------------+
| BANK ACCOUNT DATA                                                                                          |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | bank_id              | Alphanumeric | 3    | Unique bank number in Febraban list febraban_      |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | branch               | Numeric      | 15   |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | branch_digit         | Numeric      | 2    |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | account_number       | Numeric      | 20   |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | account_number_digit | Numeric      | 2    |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | document_type        | Alphanumeric |      | corporate / individual                             |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | document_number      | Alphanumeric | 20   | used to CPF when individual or CNPJ when corporate |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | account_type         | Alphanumeric |      | checking / savings                                 |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | account_holder       | Alphanumeric | 100  | name of account holder                             |
+----------+----------------------+--------------+------+----------------------------------------------------+

.. _febraban: http://www.febraban.org.br/arquivo/bancos/sitebancos2-0.asp

The correct request will return http status code ``201`` with the response below:

.. code-block:: php

    {
        'payleven_id' : 1344x343xa1
    }

**Handle Errors**

+------------------+---------------------------+
| HTTP STATUS CODE | Definition                |
+==================+===========================+
| 400              | Validation Errors         |
+------------------+---------------------------+
| 404              | Authentication Error      |
+------------------+---------------------------+
| 409              | Duplicated Merchant       |
+------------------+---------------------------+
| 500              | Server Error              |
+------------------+---------------------------+

Update
------

+----------+-----------------------+
| ENDPOINT | /api/customer/update/ |
+----------+-----------------------+
| METHOD   | POST                  |
+----------+-----------------------+

**Fields Description**

+----------+----------------------+--------------+------+----------------------------------------------------+
| Required | Field                | Type         | Size | Description                                        |
+==========+======================+==============+======+====================================================+
| PERSONAL DATA                                                                                              |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | merchant_reference   | Alphanumeric | 128  | UniqueID generated in partner registration process |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | payleven_id          | Numeric      | 11   | payleven UniqueID                                  |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | email                | Numeric      | 11   |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | cpf                  | Numeric      | 11   | No formatting is required, Ex. 72816426289         |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | first_name           | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | last_name            | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | gender               | Alphanumeric | 1    | M= Male / F= Female                                |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | birth_date           | Date         | 10   | Format d/m/Y / Ex 02/12/1993                       |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | document             | Numeric      | 20   | In Brazil we use for RG, no formatting is required |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | phone                | Numeric      | 20   | No formatting is required with DDD, ex. 1123234444 |
+----------+----------------------+--------------+------+----------------------------------------------------+
| NO       | mobile_phone         | Numeric      | 20   | No formatting is required with DDD, ex. 1123234444 |
+----------+----------------------+--------------+------+----------------------------------------------------+
| ADDRESS DATA                                                                                               |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | address_line1        | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | address_line2        | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | number               | Numeric      | 10   |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | neighborhood         | Alphanumeric | 100  |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | postal_code          | Numeric      | 8    |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | city                 | Alphanumeric | 20   |                                                    |
+----------+----------------------+--------------+------+----------------------------------------------------+
| YES      | state                | Alphanumeric | 2    | Always using abbreviation form.  Ex. SP / RJ / MG  |
+----------+----------------------+--------------+------+----------------------------------------------------+

The correct request will return http status code ``200`` with the response below:

.. code-block:: php

    {
        'message': 'Successful.'
        'response':
            'payleven_id' : 1344x343xa1
            'merchant_reference' : 1c23432dddddd23423xa
            'updated_at' : 2015-03-01 08:30:31
    }


**Example**:

.. code-block:: php

    $data = array (
        "payleven_id"        => "12450",
        "merchant_reference" => "51671925315226f2200003c8",
        "email"              => "wx234q@hotmail.com",
        "first_name"         => "Valdeciro",
        "last_name"          => "Quintas",
        "cpf"                => "93261625910",
        "document"           => "18018266",
        "birth_date"         => "09/04/1967",
        "mobile_phone"       => "11964122267",
        "phone"              => "11964122267",
        "address"            => array (
            "postal_code"   => "03716160",
            "number"        => "112",
            "address_line1" => "Jose Pinheiro",
            "address_line2" => "Casa 1",
            "neighborhood"  => "Água Branca",
            "city"          => "São Paulo",
            "state"         => "SP"
        )
    );

**Handle Errors**

+------------------+---------------------------+
| HTTP STATUS CODE | Definition                |
+==================+===========================+
| 403              | Authentication Error      |
+------------------+---------------------------+
| 404              | Merchant Not Found        |
+------------------+---------------------------+
| 412              | Required fields           |
+------------------+---------------------------+
| 500              | Server Error              |
+------------------+---------------------------+

For more information check the full examples in partner-api-example_

.. _partner-api-example: https://bitbucket.org/paylevenland/partner-api-example